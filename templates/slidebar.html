<div id="sidebar" class="h-full w-[20%] bg-slate-700 shadow-md rounded-lg flex flex-col p-4 pr-0 gap-4">
    <span class="text-white text-lg font-bold">Settings</span>

    <div class="overflow-y-auto flex flex-col gap-4 pr-4">
        <div class="flex flex-col gap-2">
            <label for="player1" class="text-white">Player 1</label>
            <select id="player1" class="rounded p-2">
                <option value="human">Human</option>
                <option value="agent">Agent</option>
            </select>
        </div>

        <div id="agent-config-1" class="hidden flex flex-col gap-4">
            <div class="flex flex-col gap-2">
                <label for="model-select-1" class="text-white">Model</label>
                <select id="model-select-1" class="rounded p-2">
                    <option value="model1">Model 1</option>
                    <option value="model2">Model 2</option>
                    <option value="model3">Model 3</option>
                </select>
            </div>

            <div class="flex flex-col gap-2">
                <label for="temperature-1" class="text-white">Temperature</label>
                <div class="flex items-center gap-2">
                    <input type="range" id="temperature-1" min="0" max="1.5" step="0.1" class="w-full" value="0.7">
                    <input type="number" id="temperature-value-1" min="0" max="1.5" step="0.1" class="w-16 rounded"
                        value="0.7">
                </div>
            </div>

            <div class="flex flex-col gap-2">
                <label for="max-tokens-1" class="text-white">Max Tokens</label>
                <div class="flex items-center gap-2">
                    <input type="range" id="max-tokens-1" min="50" max="1000" step="1" class="w-full" value="50">
                    <input type="number" id="max-tokens-value-1" min="50" max="1000" step="1" class="w-16 rounded"
                        value="50">
                </div>
            </div>

            <div class="flex flex-col gap-2">
                <label for="top-p-1" class="text-white">Top-p</label>
                <div class="flex items-center gap-2">
                    <input type="range" id="top-p-1" min="5" max="50" step="1" class="w-full" value="5">
                    <input type="number" id="top-p-value-1" min="5" max="50" step="1" class="w-16 rounded" value="5">
                </div>
            </div>

            <div class="flex items-center gap-2">
                <input type="checkbox" id="thinking-mode-1">
                <label for="thinking-mode-1" class="text-white">Thinking Mode</label>
            </div>
        </div>

        <hr>

        <div class="flex flex-col gap-2">
            <label for="player2" class="text-white">Player 2</label>
            <select id="player2" class="rounded p-2">
                <option value="human">Human</option>
                <option value="agent">Agent</option>
            </select>
        </div>

        <div id="agent-config-2" class="hidden flex flex-col gap-4">
            <div class="flex flex-col gap-2">
                <label for="model-select-2" class="text-white">Model</label>
                <select id="model-select-2" class="rounded p-2">
                    <option value="model1">Model 1</option>
                    <option value="model2">Model 2</option>
                    <option value="model3">Model 3</option>
                </select>
            </div>

            <div class="flex flex-col gap-2">
                <label for="temperature-2" class="text-white">Temperature</label>
                <div class="flex items-center gap-2">
                    <input type="range" id="temperature-2" min="0" max="1.5" step="0.1" class="w-full" value="0.7">
                    <input type="number" id="temperature-value-2" min="0" max="1.5" step="0.1" class="w-16 rounded"
                        value="0.7">
                </div>
            </div>

            <div class="flex flex-col gap-2">
                <label for="max-tokens-2" class="text-white">Max Tokens</label>
                <div class="flex items-center gap-2">
                    <input type="range" id="max-tokens-2" min="50" max="1000" step="1" class="w-full" value="50">
                    <input type="number" id="max-tokens-value-2" min="50" max="1000" step="1" class="w-16 rounded"
                        value="50">
                </div>
            </div>

            <div class="flex flex-col gap-2">
                <label for="top-p-2" class="text-white">Top-p</label>
                <div class="flex items-center gap-2">
                    <input type="range" id="top-p-2" min="5" max="50" step="1" class="w-full" value="5">
                    <input type="number" id="top-p-value-2" min="5" max="50" step="1" class="w-16 rounded" value="5">
                </div>
            </div>

            <div class="flex items-center gap-2">
                <input type="checkbox" id="thinking-mode-2">
                <label for="thinking-mode-2" class="text-white">Thinking Mode</label>
            </div>
        </div>
    </div>
    
    <hr>

    <div class="flex flex-col gap-2">
        <span class="text-white text-lg font-bold">Rules</span>
        <div class="overflow-y-auto flex flex-col gap-4 pr-4">
            <div class="flex items-start gap-2">
                <input type="checkbox" id="rule-e1" class="mt-1">
                <label for="rule-e1" class="text-white text-sm">
                    <span class="font-bold">E1 - Immature Mandarin Rule.</span>
                </label>
            </div>
            <div class="flex items-start gap-2">
                <input type="checkbox" id="rule-e2" class="mt-1">
                <label for="rule-e2" class="text-white text-sm">
                    <span class="font-bold">E2 - Forced Redistribution.</span>
                </label>
            </div>
            <div class="flex items-start gap-2">
                <input type="checkbox" id="rule-e3" class="mt-1">
                <label for="rule-e3" class="text-white text-sm">
                    <span class="font-bold">E3 - Early Game Restriction.</span>
                </label>
            </div>
            <div class="flex items-start gap-2">
                <input type="checkbox" id="rule-e4" class="mt-1">
                <label for="rule-e4" class="text-white text-sm">
                    <span class="font-bold">E4 - Two-Empty Rule.</span>
                </label>
            </div>
            <div class="flex items-start gap-2">
                <input type="checkbox" id="rule-e5" class="mt-1">
                <label for="rule-e5" class="text-white text-sm">
                    <span class="font-bold">E5 - Forced Capture Chain.</span>
                </label>
            </div>
        </div>
    </div>


    <button id="apply-config" class="bg-blue-500 text-white py-2 px-4 rounded disabled:opacity-50 mr-4">
        Apply Configuration
    </button>
</div>

<script>
    // Logic for toggling visibility of agent configurations
    document.getElementById('player1').addEventListener('change', function () {
        document.getElementById('agent-config-1').classList.toggle('hidden', this.value !== 'agent');
    });

    document.getElementById('player2').addEventListener('change', function () {
        document.getElementById('agent-config-2').classList.toggle('hidden', this.value !== 'agent');
    });

    // Synchronize range and number inputs
    function syncRangeAndNumber(rangeId, numberId) {
        const range = document.getElementById(rangeId);
        const number = document.getElementById(numberId);
        const applyButton = document.getElementById("apply-config");

        function validateInput() {
            const numValue = parseFloat(number.value);
            if (numValue < parseFloat(range.min) || numValue > parseFloat(range.max)) {
                number.setCustomValidity(`Nhập trong khoảng ${range.min} - ${range.max}`);
                number.reportValidity();
                applyButton.disabled = true;
            } else {
                number.setCustomValidity('');
                applyButton.disabled = false;
            }
        }

        // Update number input when range slider changes
        range.addEventListener('input', function () {
            number.value = range.value;
        });

        // Update range slider when number input changes
        number.addEventListener('input', function () {
            const numValue = parseFloat(number.value);

            if (numValue >= range.min && numValue <= range.max) {
                range.value = number.value;
            }
            validateInput();
        });

        validateInput();
    }

    // Synchronize range and number inputs
    syncRangeAndNumber('temperature-1', 'temperature-value-1');
    syncRangeAndNumber('max-tokens-1', 'max-tokens-value-1');
    syncRangeAndNumber('top-p-1', 'top-p-value-1');
    syncRangeAndNumber('temperature-2', 'temperature-value-2');
    syncRangeAndNumber('max-tokens-2', 'max-tokens-value-2');
    syncRangeAndNumber('top-p-2', 'top-p-value-2');

    // Handle Apply Configuration button click
    document.getElementById('apply-config').addEventListener('click', function () {
        const player1Type = document.getElementById('player1').value;
        const player2Type = document.getElementById('player2').value;

        const settings = {
            player1: {
                type: player1Type,
                model: player1Type === 'agent' ? document.getElementById('model-select-1')?.value : null,
                temperature: player1Type === 'agent' ? parseFloat(document.getElementById('temperature-value-1')?.value) : null,
                maxTokens: player1Type === 'agent' ? parseInt(document.getElementById('max-tokens-value-1')?.value) : null,
                topP: player1Type === 'agent' ? parseFloat(document.getElementById('top-p-value-1')?.value) : null,
                thinkingMode: player1Type === 'agent' ? document.getElementById('thinking-mode-1')?.checked : null,
            },
            player2: {
                type: player2Type,
                model: player2Type === 'agent' ? document.getElementById('model-select-2')?.value : null,
                temperature: player2Type === 'agent' ? parseFloat(document.getElementById('temperature-value-2')?.value) : null,
                maxTokens: player2Type === 'agent' ? parseInt(document.getElementById('max-tokens-value-2')?.value) : null,
                topP: player2Type === 'agent' ? parseFloat(document.getElementById('top-p-value-2')?.value) : null,
                thinkingMode: player2Type === 'agent' ? document.getElementById('thinking-mode-2')?.checked : null,
            },
        };
        console.log(JSON.stringify(settings, null, 2));
    });
</script>